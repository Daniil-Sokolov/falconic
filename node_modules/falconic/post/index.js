'use strict';
const querystring = require('querystring');

const forms = (req, res, callback) => {
	if (req.method == 'POST') {
		var body = '';
	}

	req
	.on('readable', function() {
	  var content;
	  if(null !== (content = req.read())) body += content;
	  if(body !== undefined){
		  if (body.length > 1e4) {
		    res.statusCode = 413;
		    res.end("Слишком много текста.");
		  }	  	
	  }
	})
	.on('end', function() {
	  try {
		body = querystring.parse(body);
		callback(null, body);
	  } catch (e) {
	    res.statusCode = 400;
	    res.end("Bad Request");
	    return;
	  }
	});

	//res.end("ok");
}


const fetch = (req, res, callback) => {
	if (req.method == 'POST') {
		var body = '';
	}

	req
	.on('readable', function() {
	  var content;
	  if(null !== (content = req.read())) body += content;
	  if(body !== undefined){
		  if (body.length > 1e4) {
		    res.statusCode = 413;
		    res.end("Your message is too big for my little chat");
		  }	  	
	  }
	})
	.on('end', function() {
	  try {
	    body = JSON.parse(body);
    	callback(null, body);
	  } catch (e) {
	    res.statusCode = 400;
	    res.end("Bad Request");
	    return;
	  }
	});

	res.end("ok");
}

module.exports = {
	forms,
	fetch
}